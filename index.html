<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåà OCD Fun Tracker</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #a8edea, #fed6e3);
  margin: 0; padding: 0;
  text-align: center;
  overflow-x: hidden;
}
.container {
  max-width: 750px;
  margin: 40px auto;
  background: rgba(255,255,255,0.9);
  border-radius: 20px;
  padding: 25px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  position: relative;
}
h1 { color: #6a5acd; margin-bottom: 10px; }
button {
  border: none;
  border-radius: 10px;
  padding: 10px 18px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
  margin: 6px;
}
button.main { background: #6a5acd; color: white; }
button.alt { background: #eee; }
button:hover { transform: scale(1.05); }
input {
  margin: 6px;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
.challengeList div {
  background: linear-gradient(90deg,#f9f9ff,#f1f1ff);
  border-radius: 10px;
  padding: 10px 12px;
  margin: 6px 0;
  text-align: left;
  font-size: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.challengeList button {
  float: right;
  background: #ff6b6b;
  color: white;
  border-radius: 6px;
  font-size: 12px;
  padding: 3px 6px;
}
.challenge { text-align: left; margin: 8px 0; font-size: 16px; }
input[type=checkbox] { transform: scale(1.3); margin-right: 8px; }
#progressContainer {
  height: 18px; background: #ddd;
  border-radius: 10px; margin-top: 10px;
  overflow: hidden;
}
#progressBar {
  height: 100%; width: 0%;
  background: linear-gradient(90deg,#6a5acd,#836fff);
  transition: width 0.8s ease;
}
.giftCard {
  display: inline-block;
  padding: 8px 12px;
  margin: 4px;
  border-radius: 10px;
  color: white;
  font-size: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
.hidden { display: none; }
#switchBtns { margin-bottom: 15px; }
#streakBadge {
  background: #ffaf00;
  color: white;
  display: inline-block;
  padding: 5px 12px;
  border-radius: 12px;
  margin-top: 8px;
  font-weight: 600;
}
.confetti {
  position: fixed;
  top: -10px;
  font-size: 24px;
  animation: fall 3s linear forwards;
}
@keyframes fall {
  to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}
</style>
</head>
<body>

<div class="container fade show">
  <h1>üåà OCD Fun Tracker</h1>
  <div id="switchBtns">
    <button class="main" onclick="showSetup()">‚öôÔ∏è Setup</button>
    <button class="alt" onclick="showTracker()">üéØ Tracker</button>
  </div>

  <!-- SETUP PAGE -->
  <div id="setupPage">
    <h2>üß© Your Challenges</h2>
    <p>Add your own tasks with 1‚Äì13 points each.</p>
    <input type="text" id="newText" placeholder="Challenge name">
    <input type="number" id="newPoints" placeholder="Pts" min="1" max="13" style="width:70px;">
    <button class="main" onclick="addChallenge()">Add</button>
    <div class="challengeList" id="challengeList"></div>

    <h2>üéÅ Your Gifts</h2>
    <p>Add gifts you earn every 300 points!</p>
    <input type="text" id="giftName" placeholder="Gift name">
    <input type="text" id="giftEmoji" placeholder="Emoji (üéÅ)">
    <button class="main" onclick="addGift()">Add Gift</button>
    <div class="challengeList" id="giftList"></div>
  </div>

  <!-- TRACKER PAGE -->
  <div id="trackerPage" class="hidden">
    <p>Max 13 points/day. Every 300 total points unlocks your next gift! üéÅ</p>
    <form id="trackerForm"></form>
    <button class="main" onclick="submitPoints()">‚úÖ Submit</button>

    <div id="result"></div>
    <div id="progressContainer"><div id="progressBar"></div></div>
    <div id="streakBadge"></div>
    <div id="giftsDisplay"></div>
  </div>
</div>

<audio id="chime" src="https://cdn.pixabay.com/audio/2021/08/04/audio_b37c2e912d.mp3"></audio>

<script>
const maxPoints = 13, pointsPerGift = 300;
let fears = JSON.parse(localStorage.getItem('fears')) || [];
let totalPoints = parseInt(localStorage.getItem('totalPoints')) || 0;
let giftsUnlocked = JSON.parse(localStorage.getItem('giftsUnlocked')) || [];
let giftPool = JSON.parse(localStorage.getItem('giftPool')) || [];
let lastDay = localStorage.getItem('lastDay') || "";
let streak = parseInt(localStorage.getItem('streak')) || 0;

/* SETUP */
function renderSetup() {
  const clist = document.getElementById('challengeList');
  clist.innerHTML = fears.length === 0 ? "<p>No challenges yet!</p>" :
    fears.map((c, i) => `<div>${i+1}. ${c.text} (${c.pts} pts)
    <button onclick="delChallenge(${i})">‚ùå</button></div>`).join('');

  const glist = document.getElementById('giftList');
  glist.innerHTML = giftPool.length === 0 ? "<p>No gifts yet!</p>" :
    giftPool.map((g, i) => `<div>${g.emoji} ${g.name}
    <button onclick="delGift(${i})">‚ùå</button></div>`).join('');
}

function addChallenge() {
  const text = document.getElementById('newText').value.trim();
  const pts = parseInt(document.getElementById('newPoints').value);
  if (!text || !pts) return alert("Enter both name and points!");
  if (pts > 13) return alert("Max 13 points per challenge!");
  fears.push({ text, pts });
  localStorage.setItem('fears', JSON.stringify(fears));
  document.getElementById('newText').value = "";
  document.getElementById('newPoints').value = "";
  renderSetup();
}

function delChallenge(i) {
  fears.splice(i, 1);
  localStorage.setItem('fears', JSON.stringify(fears));
  renderSetup();
}

function addGift() {
  const name = document.getElementById('giftName').value.trim();
  const emoji = document.getElementById('giftEmoji').value.trim() || "üéÅ";
  if (!name) return alert("Enter a gift name!");
  giftPool.push({ name, emoji });
  localStorage.setItem('giftPool', JSON.stringify(giftPool));
  document.getElementById('giftName').value = "";
  document.getElementById('giftEmoji').value = "";
  renderSetup();
}

function delGift(i) {
  giftPool.splice(i, 1);
  localStorage.setItem('giftPool', JSON.stringify(giftPool));
  renderSetup();
}

/* TRACKER */
function renderTracker() {
  const form = document.getElementById('trackerForm');
  form.innerHTML = fears.length === 0
    ? "<p>No challenges found!</p>"
    : fears.map((f, i) =>
      `<div class="challenge"><input type="checkbox" id="f${i}"> ${f.text} (${f.pts})</div>`).join('');
  updateDisplay();
}

function updateDisplay() {
  document.getElementById('result').innerHTML = `Progress: ${totalPoints % pointsPerGift}/300`;
  document.getElementById('progressBar').style.width =
    ((totalPoints % pointsPerGift) / pointsPerGift * 100) + '%';
  document.getElementById('streakBadge').innerText = `üî• ${streak} day streak`;

  const display = document.getElementById('giftsDisplay');
  display.innerHTML = giftsUnlocked.length === 0
    ? "<p>No gifts unlocked yet!</p>"
    : giftsUnlocked.map(g =>
      `<div class="giftCard" style="background:#6a5acd">${g.emoji} ${g.name}</div>`).join('');
}

function submitPoints() {
  let daily = 0;
  fears.forEach((f, i) => { if (document.getElementById('f' + i)?.checked) daily += f.pts; });
  if (daily === 0) return alert("Select at least one challenge!");
  if (daily > maxPoints) return alert("Max 13 points/day!");

  const today = new Date().toDateString();
  if (lastDay && (new Date(today) - new Date(lastDay)) / (1000 * 3600 * 24) === 1) streak++;
  else if (today !== lastDay) streak = 1;
  lastDay = today;
  totalPoints += daily;

  // Unlock gifts
  while (totalPoints >= pointsPerGift * (giftsUnlocked.length + 1)) {
    let newGift;
    if (giftPool.length > giftsUnlocked.length) {
      newGift = giftPool[giftsUnlocked.length];
    } else {
      // fallback default
      const defaults = ['Lumi','Fizz','Sparkle','Bumble'];
      newGift = { name: defaults[Math.floor(Math.random()*defaults.length)], emoji: "üßù‚Äç‚ôÄÔ∏è" };
    }
    giftsUnlocked.push(newGift);
    document.getElementById('chime').play();
    alert(`üéâ You unlocked: ${newGift.emoji} ${newGift.name}!`);
    throwConfetti();
  }

  localStorage.setItem('totalPoints', totalPoints);
  localStorage.setItem('giftsUnlocked', JSON.stringify(giftsUnlocked));
  localStorage.setItem('lastDay', lastDay);
  localStorage.setItem('streak', streak);

  document.getElementById('trackerForm').reset();
  updateDisplay();
  document.getElementById('result').innerHTML += `<br>üåü You earned ${daily} points today!`;
}

/* NAVIGATION */
function showSetup() {
  document.getElementById('setupPage').classList.remove('hidden');
  document.getElementById('trackerPage').classList.add('hidden');
  renderSetup();
}
function showTracker() {
  document.getElementById('setupPage').classList.add('hidden');
  document.getElementById('trackerPage').classList.remove('hidden');
  renderTracker();
}

/* CONFETTI */
function throwConfetti() {
  for (let i = 0; i < 20; i++) {
    const c = document.createElement('div');
    c.className = 'confetti';
    c.textContent = ['üéÅ','‚ú®','üí´','üåà'][Math.floor(Math.random() * 4)];
    c.style.left = Math.random() * 100 + 'vw';
    c.style.animationDelay = Math.random() * 0.3 + 's';
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 3000);
  }
}

/* INIT */
renderSetup();
</script>
</body>
</html>
